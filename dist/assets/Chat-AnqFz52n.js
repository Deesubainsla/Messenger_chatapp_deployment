import{r as a,M as b,j as e,u as F,b as H,n as R,a as m}from"./index-CeTxdQf5.js";import{L as I,P}from"./Layout-Da-38rgK.js";import{c as L}from"./createSvgIcon-CWhY_847.js";function B({sender:c,content:h,avatar:d="https://img.daisyui.com/images/stock/photo-1534528741775-53994a69daeb.webp"}){const{user:u}=a.useContext(b),o=c==u;return e.jsx(e.Fragment,{children:e.jsx("div",{children:e.jsxs("div",{className:`chat ${o?"chat-end":"chat-start"} z-0`,children:[e.jsx("div",{className:"chat-image avatar",children:e.jsx("div",{className:"w-10 rounded-full",children:e.jsx("img",{alt:"Tailwind CSS chat bubble component",src:d})})}),e.jsx("div",{className:"chat-bubble bg-blue-300",children:h})]})})})}const K=L(e.jsx("path",{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6zM19 4h-3.5l-1-1h-5l-1 1H5v2h14z"}),"Delete");function V(){var v;const[c,h]=a.useState(""),[d,u]=a.useState([]),[o,x]=a.useState(!1),[j,y]=a.useState(!1),[n,N]=a.useState(null),[C,S]=a.useState(null),[$,E]=a.useState(!1),k=new Audio("/notificationrecieve.wav"),D=new Audio("/msgsend.wav"),T=new Audio("/msgrecieve.mp3");let f=a.useRef(null),p=a.useRef(null),g=a.useRef(null);g.current=o;const z=F();a.useEffect(()=>{g.current=o},[o]);const{chatid:i}=H(),{socket:r}=a.useContext(b),{setnotification:M}=R();a.useEffect(()=>{f.current&&(f.current.scrollTop=f.current.scrollHeight)},[d]),a.useEffect(()=>(r&&(r.on("messagerecieve",t=>{i&&t.chat._id==i?(u(s=>[...s,t]),T.play()):(M(s=>[t,...s]),k.play())}),r.on("typing",t=>{t._id==i&&(console.log("in typing listner:"),y(!0))}),r.on("stop typing",t=>{t._id===i&&y(!1)})),()=>{r&&(r.off("messagerecieve"),r.off("typing"),r.off("stop typing"))}),[r,i]);const w=async t=>{if(t.preventDefault(),g.current&&(r.emit("stop typing",n),x(!1),clearTimeout(p.current)),c.trim()!="")try{const s=await m.post("/api/v1/message/newmessage",{chatid:i,content:c},{withCredentials:!0});h(""),u(l=>[...l,s.data.newmessage]),D.play(),r.emit("new message",s.data.newmessage)}catch(s){console.log(s.response.data.message)}};a.useEffect(()=>{n&&(async()=>{var t,s;try{const l=await m.get(`/api/v1/user/getanyprofile?userid=${(t=n==null?void 0:n.otheruser)==null?void 0:t._id}`,{withCredentials:!0,headers:{"Content-Type":"application/json"}});S((s=l.data)==null?void 0:s.user)}catch(l){console.log(l.response.data.message)}})()},[n]),a.useEffect(()=>{(async()=>{try{const s=await m.get(`/api/v1/message/getmessages?chatid=${i}`,{withCredentials:!0}),l=await m.get(`/api/v1/chat/getmychat?chatid=${i}`,{withCredentials:!0});N(l.data.mychat),u(s.data.messages)}catch(s){console.log(s.response.data.message)}})()},[i]);const _=t=>{h(t.target.value),p.current&&clearTimeout(p.current),o||(x(!0),r.emit("typing",n));const s=3e3,l=Date.now();p.current=setTimeout(()=>{Date.now()-l>=s&&g.current&&(r.emit("stop typing",n),x(!1))},s)},A=async()=>{try{await m.delete(`/api/v1/chat/deletechat?chatid=${i}`,{withCredentials:!0}),z("/"),window.location.reload()}catch(t){console.log(t.response.data.message)}};return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"h-[calc(100vh-64px)]  flex flex-col w-full overflow-hidden",children:[e.jsxs("div",{className:"bg-blue-300 py-2 px-4 md:px-8 w-full  flex justify-between items-center mb-3",children:[e.jsx("div",{className:"text-2xl text-white w-full truncate font-bold",children:n==null?void 0:n.otheruser.name}),e.jsxs("div",{className:"flex gap-4  items-center justify-center",children:[e.jsx("div",{className:`${$?"z-50":"z-40"}`,children:e.jsxs("div",{className:"drawer  drawer-end",children:[e.jsx("input",{onChange:t=>E(t.target.checked),id:"chatprofile",type:"checkbox",className:"drawer-toggle"}),e.jsx("div",{className:"drawer-content ",children:e.jsx("label",{htmlFor:"chatprofile",className:"drawer-button ",children:e.jsx("div",{className:"chat-image avatar   cursor-pointer ",children:e.jsx("div",{className:"w-9 rounded-full ",children:e.jsx("img",{alt:"Tailwind CSS chat bubble component",src:(v=n==null?void 0:n.otheruser)==null?void 0:v.avatar.url})})})})}),e.jsxs("div",{className:"drawer-side",children:[e.jsx("label",{htmlFor:"chatprofile","aria-label":"close sidebar",className:"drawer-overlay"}),e.jsx("div",{className:"menu bg-white text-base-content h-full w-60 sm:w-80 p-4",children:e.jsx(P,{user:C})})]})]})}),e.jsxs("span",{children:[e.jsx("button",{onClick:()=>document.getElementById("deletebtn").showModal(),children:e.jsx(K,{color:"error"})}),e.jsx("dialog",{id:"deletebtn",className:"modal",children:e.jsxs("div",{className:"modal-box bg-white",children:[e.jsx("h3",{className:"font-bold text-red-600 text-2xl",children:"Delete Alert"}),e.jsx("p",{className:"py-4",children:"Do you really want to delete this user from your friend list"}),e.jsx("div",{className:"modal-action",children:e.jsxs("form",{method:"dialog",children:[e.jsx("button",{className:"btn",children:"Cancel"}),e.jsx("button",{onClick:A,className:"btn hover:bg-red-600 hover:scale-110 ml-4 bg-red-600 text-white",children:"Delete"})]})})]})})]})]})]}),e.jsx("div",{ref:f,className:"h-full overflow-y-auto",children:d&&d.map((t,s)=>e.jsx(B,{avatar:t.sender.avatar.url,sender:t.sender._id,content:t.content},s))}),j&&e.jsxs("div",{className:"flex items-end",children:["Typing",e.jsx("span",{className:"loading loading-dots loading-md"})]}),e.jsx("div",{className:"py-2 bg-blue-300",children:e.jsxs("form",{className:"flex px-1",onSubmit:w,children:[e.jsx("input",{className:"w-full outline-none border border-gray-400 rounded-full px-2 py-1",type:"text",placeholder:"Enter your message",value:c,onChange:_,onKeyDown:t=>{t.key==="Enter"&&c.trim()!==""&&w(t)}}),e.jsx("button",{type:"submit",className:"bg-blue-600 text-white p-2 rounded-full",children:"send"})]})})]})})}const U=I(V);export{U as default};
